<!-- âœ… Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const { createClient } = supabase;

  // ðŸ”‘ Your Supabase Project URL & Public Anon Key
  const supabaseClient = createClient(
    "https://xnqtjcovuqzajuqzaunf.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhucXRqY292dXF6YWp1cXphdW5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MzIyMzEsImV4cCI6MjA3MzEwODIzMX0.YbmzZoqOdIX_inX-khtpg1IsiCNUROAvR4Z2N85lEvM"
  );

  // âœ… Function to fetch counts
  async function fetchCounts() {
    const { data, error } = await supabaseClient.from("complaints").select("*");
    if (error) {
      console.error("Error fetching complaints:", error);
      return;
    }

    // Adjust these based on your actual column values
    let totalReports = data.length;
    let inProgress = data.filter(c => c.status === "In Progress" || c.status === "in_progress").length;
    let resolved = data.filter(c => c.status === "Resolved" || c.status === "resolved").length;

    // Update UI
    document.getElementById("totalReports").textContent = totalReports;
    document.getElementById("inProgressReports").textContent = inProgress;
    document.getElementById("resolvedReports").textContent = resolved;

    // Update Chart.js
    if (window.impactChart) {
      window.impactChart.data.datasets[0].data = [inProgress, resolved];
      window.impactChart.update();
    }
  }

  // âœ… Subscribe to real-time changes
  supabaseClient
    .channel("complaints-realtime")
    .on(
      "postgres_changes",
      { event: "*", schema: "public", table: "complaints" },
      payload => {
        console.log("Realtime update:", payload);
        fetchCounts();
      }
    )
    .subscribe();

  // Initial fetch
  fetchCounts();
</script>
